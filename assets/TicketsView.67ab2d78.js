import{z as A,ag as V,r as w,l as q,a1 as R,g as Y,j as o,m as _,u as t,G as v,D as $,k as b,q as d,E as h,y as s,n as c,K as T,M as S,N as C,x as I,o as N,ah as z,a9 as U,_ as G,U as H,a2 as D,ai as K,aj as O,ak as J,V as E,a8 as P}from"./index.db0c9519.js";import{_ as Q}from"./SelectInput.vue_vue_type_script_setup_true_lang.bbd656c0.js";import{_ as j}from"./TextInput.vue_vue_type_script_setup_true_lang.4e124a60.js";import{_ as M}from"./SpinLoading.9f7cf3d8.js";import{_ as F}from"./Tag.891e0041.js";import{_ as L}from"./SpinLoading.3c98caf7.js";import{F as W}from"./vee-validate.esm.23971dd1.js";import{c as X,a as B}from"./object.ab463b23.js";import{_ as Z}from"./TextAreaInput.vue_vue_type_script_setup_true_lang.a34795b5.js";const ee={class:"flex flex-row items-center text-gray-900 text-xl leading-tight font-medium break-words mb-2"},te=v(" Encerrado "),se=v(" Em aberto "),ae={class:"text-sm"},oe={class:"text-gray-700 text-base break-words"},ie={class:"flex flex-wrap gap-2 mt-2"},ce=v(" Visualizar "),re={class:"flex items-center"},ne=v(" Encerrar "),le={class:"flex items-center"},de=v(" Reabrir "),ue={__name:"Ticket",props:{ticket:{type:Object,required:!0}},setup(a){const u=a,i=A(),n=V();let r=w(!1),p=w(!1);const m=q(()=>R(u.ticket.dataCriacao,"DD/MM/YYYY HH:mm").value),f=()=>{r.value=!0,n.putTicketSituacao(u.ticket.idTicket,1).then(e=>u.ticket.situacao=1).catch(e=>notify({group:"error",title:e.message||e})).finally(()=>r.value=!1)},l=()=>{p.value=!0,n.putTicketSituacao(u.ticket.idTicket,0).then(e=>u.ticket.situacao=0).catch(e=>notify({group:"error",title:e.message||e})).finally(()=>p.value=!1)};return(e,y)=>{const x=Y("RouterLink");return o(),_("div",{class:I(["block p-6 mb-3 rounded-lg shadow-lg bg-white",{novo:a.ticket.novo}])},[t("h5",ee,[v($(a.ticket.assunto)+" ",1),a.ticket.situacao===1?(o(),b(F,{key:0,customColor:"green",class:"ml-2"},{default:d(()=>[te]),_:1})):h("",!0),a.ticket.situacao===0?(o(),b(F,{key:1,customColor:"blue",class:"ml-2"},{default:d(()=>[se]),_:1})):h("",!0)]),t("p",ae,$(s(m)),1),t("p",oe,$(a.ticket.descricao),1),t("div",ie,[c(x,{to:{name:"ticket",params:{id:a.ticket.idTicket}},class:"card-footer-item"},{default:d(()=>[c(T,null,{default:d(()=>[ce]),_:1})]),_:1},8,["to"]),a.ticket.situacao===0&&s(i).user.isAdministrador?(o(),b(T,{key:0,customColor:"green",onClick:f},{default:d(()=>[t("div",re,[S(c(L,{class:"mr-3"},null,512),[[C,s(r)]]),ne])]),_:1})):h("",!0),a.ticket.situacao===1&&s(i).user.isAdministrador?(o(),b(T,{key:1,customColor:"blue",onClick:l},{default:d(()=>[t("div",le,[S(c(L,{class:"mr-3"},null,512),[[C,s(p)]]),de])]),_:1})):h("",!0)])],2)}}},me={class:"block p-6 shadow-lg bg-white"},_e={class:""},fe={class:"flex items-center"},ke=v(" Criar ticket "),he={key:0,class:"text-red-700 mt-3 mb-0"},pe={__name:"ModalCreateTicket",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(a,{emit:u}){const i=X().shape({assunto:B().required("Assunto n\xE3o informado").min(10,"Assunto deve ter pelo menos 10 caracteres").max(100,"Assunto deve ter no m\xE1ximo 100 caracteres."),descricao:B().required("Descri\xE7\xE3o n\xE3o informada").min(20,"Descri\xE7\xE3o deve ter pelo menos 20 caracteres").max(500,"Descri\xE7\xE3o deve ter no m\xE1ximo 500 caracteres.")}),n=m=>{m.key};N(()=>{document.addEventListener("keyup",n)}),z(()=>{document.removeEventListener("keyup",n)});let r=w(!1);async function p(m,{resetForm:f,setErrors:l}){l({}),r.value=!0;try{const e=A(),y=V(),x={assunto:m.assunto,descricao:m.descricao};e.user.isAdministrador?x.idAdministrador=e.user.idAdministrador:x.idCliente=e.user.idCliente,await y.postTicket(x).then(k=>{y.tickets.unshift({...k.data,novo:!0}),f()}).catch(k=>l({apiError:k}))}finally{r.value=!1}}return(m,f)=>{const l=U;return o(),_("div",me,[t("div",_e,[c(s(W),{onSubmit:p,"validation-schema":s(i)},{default:d(({errors:e})=>[c(j,{name:"assunto",type:"text",label:"Assunto",placeholder:"Assunto",class:"mb-2"}),c(Z,{name:"descricao",type:"text",label:"Descri\xE7\xE3o",placeholder:"Descri\xE7\xE3o",rows:3,class:"mb-4"}),c(l,{disabled:s(r)},{default:d(()=>[t("div",fe,[S(c(M,{class:"mr-3"},null,512),[[C,s(r)]]),ke])]),_:1},8,["disabled"]),e.apiError?(o(),_("div",he,$(e.apiError),1)):h("",!0)]),_:1},8,["validation-schema"])])])}}};const g=a=>(O("data-v-ebb01586"),a=a(),J(),a),xe={class:"flex flex-col h-full"},ve=g(()=>t("div",{class:"mr-4 text-2xl font-semibold"}," Tickets de suporte ",-1)),be={class:"flex flex-wrap sm:flex-nowrap gap-x-4 gap-y-2 sm:ml-auto"},ye=g(()=>t("option",{value:"todos"},"Todos",-1)),ge=g(()=>t("option",{value:"abertos"},"Abertos",-1)),$e=g(()=>t("option",{value:"encerrados"},"Encerrados",-1)),Te={key:0,class:"flex-1 flex flex-row justify-center items-center"},we={class:"flex items-center"},Se=g(()=>t("p",{class:"text-xl text-teal-600"}," Carregando... ",-1)),Ce={key:0,class:"mb-0"},Ae={class:"flex flex-col justify-center p-6"},Ve={key:1,class:"text-xl px-6"},De={__name:"TicketsView",setup(a){const u=A(),i=V();N(()=>{i.init()});let n=null,r=null;async function p(l){r=l.target.value,E(()=>{i.getTickets(n,r)})}async function m(l){switch(l.target.value){case"abertos":n=0;break;case"encerrados":n=1;break;default:n=null}E(()=>{i.getTickets(n,r)})}const f=H({createTicket:!0});return(l,e)=>{const y=j,x=Q;return o(),_("div",xe,[t("div",{class:I(["flex flex-col sm:flex-row pt-6 pl-6 pr-6",{"bg-white":!s(u).user.isAdministrador}])},[ve,t("div",be,[c(y,{disabled:!s(i).ticketsLoaded,name:"filtroAssunto",label:"Filtrar por assunto",onChange:p,class:"shrink"},null,8,["disabled"]),c(x,{disabled:!s(i).ticketsLoaded,name:"filtroSituacao",label:"Situa\xE7\xE3o",initialValue:"todos",onChange:m},{default:d(()=>[ye,ge,$e]),_:1},8,["disabled"])])],2),s(i).ticketsLoaded?(o(),_(D,{key:1},[s(u).user.isAdministrador?h("",!0):(o(),_("div",Ce,[f.createTicket?(o(),b(pe,{key:0,modelValue:f.createTicket,"onUpdate:modelValue":e[0]||(e[0]=k=>f.createTicket=k)},null,8,["modelValue"])):h("",!0)])),t("div",Ae,[c(K,{name:"ticket"},{default:d(()=>[(o(!0),_(D,null,P(s(i).tickets,k=>(o(),b(ue,{key:k.idTicket,ticket:k},null,8,["ticket"]))),128))]),_:1})]),s(i).tickets.length?h("",!0):(o(),_("div",Ve," N\xE3o h\xE1 nenhum ticket de suporte. "))],64)):(o(),_("div",Te,[t("div",we,[c(M,{height:8,width:8,color:"text-teal-600",class:"mr-3"}),Se])]))])}}},Re=G(De,[["__scopeId","data-v-ebb01586"]]);export{Re as default};
