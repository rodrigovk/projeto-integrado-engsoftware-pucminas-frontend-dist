import{z as A,ag as V,r as w,l as M,a1 as q,g as R,j as a,m,u as t,G as v,D as $,k as b,q as d,E as h,y as o,n as c,K as T,M as S,N as C,x as Y,o as I,ah as z,a9 as U,_ as G,U as H,a2 as D,ai as K,aj as O,ak as J,V as E,a8 as P}from"./index.78bbede8.js";import{_ as Q}from"./SelectInput.vue_vue_type_script_setup_true_lang.a9db5479.js";import{_ as N}from"./TextInput.vue_vue_type_script_setup_true_lang.d0b581e8.js";import{_ as j}from"./SpinLoading.93eac245.js";import{_ as F}from"./Tag.b3b8a315.js";import{_ as L}from"./SpinLoading.75c19d37.js";import{F as W}from"./vee-validate.esm.9d97491c.js";import{c as X,a as B}from"./object.93604eaf.js";import{_ as Z}from"./TextAreaInput.vue_vue_type_script_setup_true_lang.71d895ba.js";const ee={class:"flex flex-row items-center text-gray-900 text-xl leading-tight font-medium break-words mb-2"},te=v(" Encerrado "),se=v(" Em aberto "),ae={class:"text-sm"},oe={class:"text-gray-700 text-base break-words"},ie={class:"flex flex-wrap gap-2 mt-2"},ce=v(" Visualizar "),ne={class:"flex items-center"},re=v(" Encerrar "),le={class:"flex items-center"},de=v(" Reabrir "),ue={__name:"Ticket",props:{ticket:{type:Object,required:!0}},setup(s){const _=s,i=A(),r=V();let n=w(!1),p=w(!1);const u=M(()=>q(_.ticket.dataCriacao,"DD/MM/YYYY HH:mm").value),f=()=>{n.value=!0,r.putTicketSituacao(_.ticket.idTicket,1).then(e=>_.ticket.situacao=1).catch(e=>notify({group:"error",title:e.message||e})).finally(()=>n.value=!1)},l=()=>{p.value=!0,r.putTicketSituacao(_.ticket.idTicket,0).then(e=>_.ticket.situacao=0).catch(e=>notify({group:"error",title:e.message||e})).finally(()=>p.value=!1)};return(e,y)=>{const x=R("RouterLink");return a(),m("div",{class:Y(["block p-6 mb-3 rounded-lg shadow-lg bg-white",{novo:s.ticket.novo}])},[t("h5",ee,[v($(s.ticket.assunto)+" ",1),s.ticket.situacao===1?(a(),b(F,{key:0,customColor:"green",class:"ml-2"},{default:d(()=>[te]),_:1})):h("",!0),s.ticket.situacao===0?(a(),b(F,{key:1,customColor:"blue",class:"ml-2"},{default:d(()=>[se]),_:1})):h("",!0)]),t("p",ae,$(o(u)),1),t("p",oe,$(s.ticket.descricao),1),t("div",ie,[c(x,{to:{name:"ticket",params:{id:s.ticket.idTicket}},class:"card-footer-item"},{default:d(()=>[c(T,null,{default:d(()=>[ce]),_:1})]),_:1},8,["to"]),s.ticket.situacao===0&&o(i).user.isAdministrador?(a(),b(T,{key:0,customColor:"green",onClick:f},{default:d(()=>[t("div",ne,[S(c(L,{class:"mr-3"},null,512),[[C,o(n)]]),re])]),_:1})):h("",!0),s.ticket.situacao===1&&o(i).user.isAdministrador?(a(),b(T,{key:1,customColor:"blue",onClick:l},{default:d(()=>[t("div",le,[S(c(L,{class:"mr-3"},null,512),[[C,o(p)]]),de])]),_:1})):h("",!0)])],2)}}},me={class:"block rounded-lg shadow-lg bg-white"},_e=t("h2",{class:"text-xl font-bold mb-2"},"Criar ticket",-1),fe={class:""},ke={class:"flex items-center"},he=v(" Criar ticket "),pe={key:0,class:"text-red-700 mt-3 mb-0"},xe={__name:"ModalCreateTicket",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:_}){const i=X().shape({assunto:B().required("Assunto n\xE3o informado").min(10,"Assunto deve ter pelo menos 10 caracteres").max(100,"Assunto deve ter no m\xE1ximo 100 caracteres."),descricao:B().required("Descri\xE7\xE3o n\xE3o informada").min(20,"Descri\xE7\xE3o deve ter pelo menos 20 caracteres").max(500,"Descri\xE7\xE3o deve ter no m\xE1ximo 500 caracteres.")}),r=u=>{u.key};I(()=>{document.addEventListener("keyup",r)}),z(()=>{document.removeEventListener("keyup",r)});let n=w(!1);async function p(u,{resetForm:f,setErrors:l}){l({}),n.value=!0;try{const e=A(),y=V(),x={assunto:u.assunto,descricao:u.descricao};e.user.isAdministrador?x.idAdministrador=e.user.idAdministrador:x.idCliente=e.user.idCliente,await y.postTicket(x).then(k=>{y.tickets.unshift({...k.data,novo:!0}),f()}).catch(k=>l({apiError:k}))}finally{n.value=!1}}return(u,f)=>{const l=U;return a(),m("div",me,[_e,t("div",fe,[c(o(W),{onSubmit:p,"validation-schema":o(i)},{default:d(({errors:e})=>[c(N,{name:"assunto",type:"text",label:"Assunto",placeholder:"Assunto",class:"mb-2"}),c(Z,{name:"descricao",type:"text",label:"Descri\xE7\xE3o",placeholder:"Descri\xE7\xE3o",rows:3,class:"mb-4"}),c(l,{disabled:o(n)},{default:d(()=>[t("div",ke,[S(c(j,{class:"mr-3"},null,512),[[C,o(n)]]),he])]),_:1},8,["disabled"]),e.apiError?(a(),m("div",pe,$(e.apiError),1)):h("",!0)]),_:1},8,["validation-schema"])])])}}};const g=s=>(O("data-v-8b32f136"),s=s(),J(),s),ve={class:"flex flex-col h-full"},be={class:"p-6"},ye={class:"flex flex-col sm:flex-row"},ge=g(()=>t("div",{class:"mr-4 text-2xl font-semibold"}," Tickets de suporte ",-1)),$e={class:"flex flex-wrap sm:flex-nowrap gap-x-4 gap-y-2 sm:ml-auto"},Te=g(()=>t("option",{value:"todos"},"Todos",-1)),we=g(()=>t("option",{value:"abertos"},"Abertos",-1)),Se=g(()=>t("option",{value:"encerrados"},"Encerrados",-1)),Ce={key:0,class:"flex-1 flex flex-row justify-center items-center"},Ae={class:"flex items-center"},Ve=g(()=>t("p",{class:"text-xl text-teal-600"}," Carregando... ",-1)),De={key:0,class:"mb-0 mt-4"},Ee={class:"flex flex-col justify-center pt-6"},Fe={key:1,class:"text-xl px-6"},Le={__name:"TicketsView",setup(s){const _=A(),i=V();I(()=>{i.init()});let r=null,n=null;async function p(l){n=l.target.value,E(()=>{i.getTickets(r,n)})}async function u(l){switch(l.target.value){case"abertos":r=0;break;case"encerrados":r=1;break;default:r=null}E(()=>{i.getTickets(r,n)})}const f=H({createTicket:!0});return(l,e)=>{const y=N,x=Q;return a(),m("div",ve,[t("div",be,[t("div",ye,[ge,t("div",$e,[c(y,{disabled:!o(i).ticketsLoaded,name:"filtroAssunto",label:"Filtrar por assunto",onChange:p,class:"shrink"},null,8,["disabled"]),c(x,{disabled:!o(i).ticketsLoaded,name:"filtroSituacao",label:"Situa\xE7\xE3o",initialValue:"todos",onChange:u},{default:d(()=>[Te,we,Se]),_:1},8,["disabled"])])]),o(i).ticketsLoaded?(a(),m(D,{key:1},[o(_).user.isAdministrador?h("",!0):(a(),m("div",De,[f.createTicket?(a(),b(xe,{key:0,modelValue:f.createTicket,"onUpdate:modelValue":e[0]||(e[0]=k=>f.createTicket=k),class:"p-6"},null,8,["modelValue"])):h("",!0)])),t("div",Ee,[c(K,{name:"ticket"},{default:d(()=>[(a(!0),m(D,null,P(o(i).tickets,k=>(a(),b(ue,{key:k.idTicket,ticket:k},null,8,["ticket"]))),128))]),_:1})]),o(i).tickets.length?h("",!0):(a(),m("div",Fe," N\xE3o h\xE1 nenhum ticket de suporte. "))],64)):(a(),m("div",Ce,[t("div",Ae,[c(j,{height:8,width:8,color:"text-teal-600",class:"mr-3"}),Ve])]))])])}}},Ue=G(Le,[["__scopeId","data-v-8b32f136"]]);export{Ue as default};
