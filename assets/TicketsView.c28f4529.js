import{z as A,ag as V,r as w,l as q,a1 as R,g as Y,j as a,m,u as t,G as v,D as $,k as b,q as d,E as h,y as o,n as i,K as T,M as S,N as C,x as z,a3 as D,o as N,ah as U,a9 as G,_ as H,U as K,a2 as E,ai as O,aj as J,ak as P,V as F,a8 as Q}from"./index.038c8212.js";import{_ as W}from"./SelectInput.vue_vue_type_script_setup_true_lang.b2f56bff.js";import{_ as j}from"./TextInput.vue_vue_type_script_setup_true_lang.10ae3c78.js";import{_ as M}from"./SpinLoading.5aa2b1d3.js";import{_ as L}from"./Tag.6d28a408.js";import{_ as B}from"./SpinLoading.3f6d8973.js";import{F as X}from"./vee-validate.esm.894363cd.js";import{c as Z,a as I}from"./object.eab41036.js";import{_ as ee}from"./TextAreaInput.vue_vue_type_script_setup_true_lang.1b074aff.js";const te={class:"flex flex-row items-center text-gray-900 text-xl leading-tight font-medium break-words mb-2"},se=v(" Encerrado "),ae=v(" Em aberto "),oe={class:"text-sm"},ie={class:"text-gray-700 text-base break-words"},ce={class:"flex flex-wrap gap-2 mt-2"},ne=v(" Visualizar "),re={class:"flex items-center"},le=v(" Encerrar "),de={class:"flex items-center"},ue=v(" Reabrir "),me={__name:"Ticket",props:{ticket:{type:Object,required:!0}},setup(s){const _=s,c=A(),r=V();let n=w(!1),p=w(!1);const u=q(()=>R(_.ticket.dataCriacao,"DD/MM/YYYY HH:mm").value),f=()=>{n.value=!0,r.putTicketSituacao(_.ticket.idTicket,1).then(e=>_.ticket.situacao=1).catch(e=>D({group:"error",title:e.message||e})).finally(()=>n.value=!1)},l=()=>{p.value=!0,r.putTicketSituacao(_.ticket.idTicket,0).then(e=>_.ticket.situacao=0).catch(e=>D({group:"error",title:e.message||e})).finally(()=>p.value=!1)};return(e,g)=>{const x=Y("RouterLink");return a(),m("div",{class:z(["block p-6 mb-3 rounded-lg shadow-lg bg-white",{novo:s.ticket.novo}])},[t("h5",te,[v($(s.ticket.assunto)+" ",1),s.ticket.situacao===1?(a(),b(L,{key:0,customColor:"green",class:"ml-2"},{default:d(()=>[se]),_:1})):h("",!0),s.ticket.situacao===0?(a(),b(L,{key:1,customColor:"blue",class:"ml-2"},{default:d(()=>[ae]),_:1})):h("",!0)]),t("p",oe,$(o(u)),1),t("p",ie,$(s.ticket.descricao),1),t("div",ce,[i(x,{to:{name:"ticket",params:{id:s.ticket.idTicket}},class:"card-footer-item"},{default:d(()=>[i(T,null,{default:d(()=>[ne]),_:1})]),_:1},8,["to"]),s.ticket.situacao===0?(a(),b(T,{key:0,customColor:"green",onClick:f},{default:d(()=>[t("div",re,[S(i(B,{class:"mr-3"},null,512),[[C,o(n)]]),le])]),_:1})):h("",!0),s.ticket.situacao===1&&o(c).user.isAdministrador?(a(),b(T,{key:1,customColor:"blue",onClick:l},{default:d(()=>[t("div",de,[S(i(B,{class:"mr-3"},null,512),[[C,o(p)]]),ue])]),_:1})):h("",!0)])],2)}}},_e={class:"block rounded-lg shadow-lg bg-white"},fe=t("h2",{class:"text-xl font-bold mb-2"},"Criar ticket",-1),ke={class:""},he={class:"flex items-center"},pe=v(" Criar ticket "),xe={key:0,class:"text-red-700 mt-3 mb-0"},ve={__name:"ModalCreateTicket",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:_}){const c=Z().shape({assunto:I().required("Assunto n\xE3o informado").min(10,"Assunto deve ter pelo menos 10 caracteres").max(100,"Assunto deve ter no m\xE1ximo 100 caracteres."),descricao:I().required("Descri\xE7\xE3o n\xE3o informada").min(20,"Descri\xE7\xE3o deve ter pelo menos 20 caracteres").max(500,"Descri\xE7\xE3o deve ter no m\xE1ximo 500 caracteres.")}),r=u=>{u.key};N(()=>{document.addEventListener("keyup",r)}),U(()=>{document.removeEventListener("keyup",r)});let n=w(!1);async function p(u,{resetForm:f,setErrors:l}){l({}),n.value=!0;try{const e=A(),g=V(),x={assunto:u.assunto,descricao:u.descricao};e.user.isAdministrador?x.idAdministrador=e.user.idAdministrador:x.idCliente=e.user.idCliente,await g.postTicket(x).then(k=>{g.tickets.unshift({...k.data,novo:!0}),f()}).catch(k=>l({apiError:k}))}finally{n.value=!1}}return(u,f)=>{const l=G;return a(),m("div",_e,[fe,t("div",ke,[i(o(X),{onSubmit:p,"validation-schema":o(c)},{default:d(({errors:e})=>[i(j,{name:"assunto",type:"text",label:"Assunto",placeholder:"Assunto",class:"mb-2"}),i(ee,{name:"descricao",type:"text",label:"Descri\xE7\xE3o",placeholder:"Descri\xE7\xE3o",rows:3,class:"mb-4"}),i(l,{disabled:o(n)},{default:d(()=>[t("div",he,[S(i(M,{class:"mr-3"},null,512),[[C,o(n)]]),pe])]),_:1},8,["disabled"]),e.apiError?(a(),m("div",xe,$(e.apiError),1)):h("",!0)]),_:1},8,["validation-schema"])])])}}};const y=s=>(J("data-v-8b32f136"),s=s(),P(),s),be={class:"flex flex-col h-full"},ge={class:"p-6"},ye={class:"flex flex-col sm:flex-row"},$e=y(()=>t("div",{class:"mr-4 text-2xl font-semibold"}," Tickets de suporte ",-1)),Te={class:"flex flex-wrap sm:flex-nowrap gap-x-4 gap-y-2 sm:ml-auto"},we=y(()=>t("option",{value:"todos"},"Todos",-1)),Se=y(()=>t("option",{value:"abertos"},"Abertos",-1)),Ce=y(()=>t("option",{value:"encerrados"},"Encerrados",-1)),Ae={key:0,class:"flex-1 flex flex-row justify-center items-center"},Ve={class:"flex items-center"},De=y(()=>t("p",{class:"text-xl text-teal-600"}," Carregando... ",-1)),Ee={key:0,class:"mb-0 mt-4"},Fe={class:"flex flex-col justify-center pt-6"},Le={key:1,class:"text-xl px-6"},Be={__name:"TicketsView",setup(s){const _=A(),c=V();N(()=>{c.init()});let r=null,n=null;async function p(l){n=l.target.value,F(()=>{c.getTickets(r,n)})}async function u(l){switch(l.target.value){case"abertos":r=0;break;case"encerrados":r=1;break;default:r=null}F(()=>{c.getTickets(r,n)})}const f=K({createTicket:!0});return(l,e)=>{const g=j,x=W;return a(),m("div",be,[t("div",ge,[t("div",ye,[$e,t("div",Te,[i(g,{disabled:!o(c).ticketsLoaded,name:"filtroAssunto",label:"Filtrar por assunto",onChange:p,class:"shrink"},null,8,["disabled"]),i(x,{disabled:!o(c).ticketsLoaded,name:"filtroSituacao",label:"Situa\xE7\xE3o",initialValue:"todos",onChange:u},{default:d(()=>[we,Se,Ce]),_:1},8,["disabled"])])]),o(c).ticketsLoaded?(a(),m(E,{key:1},[o(_).user.isAdministrador?h("",!0):(a(),m("div",Ee,[f.createTicket?(a(),b(ve,{key:0,modelValue:f.createTicket,"onUpdate:modelValue":e[0]||(e[0]=k=>f.createTicket=k),class:"p-6"},null,8,["modelValue"])):h("",!0)])),t("div",Fe,[i(O,{name:"ticket"},{default:d(()=>[(a(!0),m(E,null,Q(o(c).tickets,k=>(a(),b(me,{key:k.idTicket,ticket:k},null,8,["ticket"]))),128))]),_:1})]),o(c).tickets.length?h("",!0):(a(),m("div",Le," N\xE3o h\xE1 nenhum ticket de suporte. "))],64)):(a(),m("div",Ae,[t("div",Ve,[i(M,{height:8,width:8,color:"text-teal-600",class:"mr-3"}),De])]))])])}}},Ge=H(Be,[["__scopeId","data-v-8b32f136"]]);export{Ge as default};
