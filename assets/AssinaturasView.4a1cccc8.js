import{z as ia,a0 as U,r as d,l as W,a1 as ea,g as la,j as r,m as k,u as a,G as s,D as $,k as w,q as e,E as y,y as g,M as v,N as h,n as t,K as A,a2 as z,a3 as C,a4 as ua,a5 as da,a6 as ma,o as _a,w as fa,a7 as sa,a8 as oa,a9 as va,aa as ha}from"./index.78bbede8.js";import{_ as ra}from"./BaseModal.62b779d6.js";import{_ as xa}from"./TextInput.vue_vue_type_script_setup_true_lang.d0b581e8.js";import{_ as pa}from"./SelectInput.vue_vue_type_script_setup_true_lang.a9db5479.js";import{_ as ga}from"./Tag.1760c632.js";import{F as Ca}from"./vee-validate.esm.9d97491c.js";import{_ as Q}from"./SpinLoading.93eac245.js";import{_ as na}from"./Tag.b3b8a315.js";import{_ as q}from"./SpinLoading.75c19d37.js";const ba={class:"block p-6 mb-3 rounded-lg shadow-lg bg-white"},Aa={class:"flex flex-row items-center text-gray-900 text-xl leading-tight font-medium break-words mb-2"},ka=s(" Ativa "),$a=s(" Inativa "),ya={class:"text-gray-700"},Va={class:"text-base break-words mb-1"},wa={class:"text-base break-words mb-1"},Da={class:"flex md:flex-row flex-col"},Ma={class:"text-base break-words mb-1 md:mb-0 md:mr-4"},Sa={class:"text-base break-words"},Ga={class:"flex flex-wrap mt-2 gap-2"},Ba=s(" Editar "),Na={class:"flex items-center"},Pa=s(" Gerar conta "),Ia={class:"flex items-center"},Ra=s(" Ativar "),Ya={class:"flex items-center"},La=s(" Inativar "),Ea={class:"flex items-center"},Fa=s(" Excluir "),ja=a("h2",{class:"text-2xl mb-1"},"Gera\xE7\xE3o de conta da assinatura",-1),Ta={class:"mb-4"},qa=s(" Confirma a gera\xE7\xE3o de conta da assinatura de "),za=s("? "),Oa={class:"mt-4"},Ka=s(" Gerar conta "),Ha=s(" N\xE3o "),Ja=a("h2",{class:"text-2xl mb-1"},"Exclus\xE3o da assinatura",-1),Qa={class:"mb-4"},Ua=s(" Confirma a exclus\xE3o desta assinatura de "),Wa=s("? "),Xa={class:"mt-4"},Za=s(" Excluir "),at=s(" N\xE3o "),tt={__name:"Assinatura",props:{assinatura:{type:Object,required:!0}},emits:["removerAssinatura"],setup(u,{emit:D}){const m=u,O=ia(),l=U(),R=d(!1),Y=()=>{R.value=!0,l.putAssinaturaSituacao(m.assinatura.idAssinatura,1).then(o=>m.assinatura.situacao=1).catch(o=>C({group:"error",title:o.message||o})).finally(()=>R.value=!1)},S=d(!1),K=()=>{S.value=!0,l.putAssinaturaSituacao(m.assinatura.idAssinatura,0).then(o=>m.assinatura.situacao=0).catch(o=>C({group:"error",title:o.message||o})).finally(()=>S.value=!1)},x=d(null),_=()=>{x.value=!x.value},G=d(!1),L=()=>{G.value=!0,l.deleteAssinatura(m.assinatura.idAssinatura).then(o=>D("removerAssinatura",m.assinatura.idAssinatura)).catch(o=>C({group:"error",title:o.message||o})).finally(()=>{G.value=!1,_.value&&(_.value=!1)})},p=d(null),E=()=>{p.value=!p.value},f=d(!1),H=()=>{f.value=!0,l.generateContaAssinatura(m.assinatura.idAssinatura).then(o=>{C({group:"ok",title:"Conta gerada com sucesso."}),l.init()}).catch(o=>C({group:"error",title:o.message||o})).finally(()=>{f.value=!1,p.value&&(p.value=!1)})},M=W(()=>ea(m.assinatura.dataVencimento,"DD/MM/YYYY").value),F=W(()=>ea(m.assinatura.dataProximoVencimento,"DD/MM/YYYY").value);return(o,X)=>{const n=la("RouterLink"),c=ra;return r(),k(z,null,[a("div",ba,[a("h5",Aa,[s($(u.assinatura.cliente.nome)+" ",1),u.assinatura.situacao===1?(r(),w(na,{key:0,customColor:"green",class:"ml-2"},{default:e(()=>[ka]),_:1})):y("",!0),u.assinatura.situacao===0?(r(),w(na,{key:1,customColor:"orange",class:"ml-2"},{default:e(()=>[$a]),_:1})):y("",!0)]),a("div",ya,[a("p",Va,$(u.assinatura.descricao),1),a("p",wa," Valor: "+$(o.vueNumberFormat(u.assinatura.valor,{})),1),a("div",Da,[a("p",Ma," Data vencimento: "+$(g(M)),1),a("p",Sa," Pr\xF3ximo vencimento: "+$(g(F)),1)])]),v(a("div",Ga,[t(n,{to:{name:"assinatura",params:{id:u.assinatura.idAssinatura}}},{default:e(()=>[t(A,null,{default:e(()=>[Ba]),_:1})]),_:1},8,["to"]),u.assinatura.situacao===1?(r(),w(A,{key:0,customColor:"teal",onClick:E},{default:e(()=>[a("div",Na,[v(t(q,{class:"mr-3"},null,512),[[h,f.value]]),Pa])]),_:1})):y("",!0),u.assinatura.situacao===0?(r(),w(A,{key:1,customColor:"green",onClick:Y},{default:e(()=>[a("div",Ia,[v(t(q,{class:"mr-3"},null,512),[[h,R.value]]),Ra])]),_:1})):y("",!0),u.assinatura.situacao===1?(r(),w(A,{key:2,customColor:"orange",onClick:K},{default:e(()=>[a("div",Ya,[v(t(q,{class:"mr-3"},null,512),[[h,S.value]]),La])]),_:1})):y("",!0),t(A,{customColor:"red",onClick:_,class:"sm:ml-auto"},{default:e(()=>[a("div",Ea,[v(t(q,{class:"mr-3"},null,512),[[h,G.value]]),Fa])]),_:1})],512),[[h,g(O).user.isAdministrador]])]),t(c,{modalActive:p.value,closeButtonVisible:!1,onCloseModal:E},{default:e(()=>[a("div",null,[ja,a("p",Ta,[qa,a("b",null,$(u.assinatura.cliente.nome),1),za])]),a("div",Oa,[t(A,{onClick:H,class:"mr-2"},{default:e(()=>[Ka]),_:1}),t(A,{onClick:E},{default:e(()=>[Ha]),_:1})])]),_:1},8,["modalActive"]),t(c,{modalActive:x.value,closeButtonVisible:!1,onCloseModal:_},{default:e(()=>[a("div",null,[Ja,a("p",Qa,[Ua,a("b",null,$(u.assinatura.cliente.nome),1),Wa])]),a("div",Xa,[t(A,{onClick:L,customColor:"red",class:"mr-2"},{default:e(()=>[Za]),_:1}),t(A,{onClick:_},{default:e(()=>[at]),_:1})])]),_:1},8,["modalActive"])],64)}}},et={class:"h-full"},st={class:"p-6"},ot={class:"flex flex-col h-full"},nt=a("div",{class:"flex items-center text-2xl font-semibold"}," Assinaturas ",-1),it={key:0,class:"flex-1 flex flex-row justify-center items-center"},lt={class:"flex items-center"},rt=a("p",{class:"text-xl text-teal-600"}," Carregando... ",-1),ct={class:"flex flex-wrap gap-2 mt-2"},ut=s(" Criar assinatura "),dt=s(" Gerar contas "),mt={class:"flex flex-col justify-center pt-6"},_t={key:0,class:"text-xl px-6"},ft={class:""},vt=a("h2",{class:"text-2xl mb-1"},"Assinatura",-1),ht={class:"mb-2"},xt=s(" Ativa "),pt=s(" Inativa "),gt=["value"],Ct={class:"mt-4"},bt={class:"flex"},At={class:"flex items-center"},kt=s(" Gravando... "),$t=s(" Descartar "),yt={key:0,class:"text-red-700 mt-3 mb-0"},Vt=a("div",null,[a("h2",{class:"text-2xl mb-1"},"Gera\xE7\xE3o de contas das assinaturas"),a("p",{class:"mb-4"}," Confirma a gera\xE7\xE3o de contas das assinaturas com vencimento pr\xF3ximo? ")],-1),wt={class:"mt-4"},Dt=s(" Gerar contas "),Mt=s(" N\xE3o "),Et={__name:"AssinaturasView",emits:["closeMenu"],setup(u){const D=ua(),m=da(),O=ia(),l=U(),R=ma();_a(()=>{if(l.init(),D.path==="/assinaturas/novo"){p(0);return}if(D.params.id){p(D.params.id);return}}),fa(()=>D,(n,c)=>{if(n.path==="/assinaturas/novo"){p(0);return}if(n.params.id){p(n.params.id);return}},{deep:!0});const Y=d([]),S=d(!1);function K(){S.value=!1,R.getClientesSimples().then(n=>{Y.value=n.data}).finally(S.value=!0)}const x=d({}),_=d(null),G=()=>{_.value=!_.value},L=W(()=>D.params.id===void 0);function p(n){n>0?l.getAssinatura(n).then(c=>{const i=c.data;i.dataVencimento=sa(new Date(i.dataVencimento)),i.dataProximoVencimento=sa(new Date(i.dataProximoVencimento)),x.value=i,_.value=!0}):(x.value={},_.value=!0),K()}function E(n){const c=l.assinaturas.findIndex(i=>i.idAssinatura===n);l.assinaturas.splice(c,1)}const f=d(!1);function H(n,{setFieldError:c,setErrors:i,resetForm:J}){i({});const j=U(),{idCliente:T,descricao:V,valor:B,dataVencimento:b,dataProximoVencimento:N}=n;let P=0;if((T===null||T==="")&&(c("idCliente","Cliente n\xE3o informado."),P++),V.length===0&&(c("descricao","Descri\xE7\xE3o n\xE3o informada."),P++),(B===null||B==="")&&(c("valor","Valor n\xE3o informado."),P++),(b===null||b==="")&&(c("dataVencimento","Data de vencimento n\xE3o informada."),P++),(N===null||N==="")&&(c("dataProximoVencimento","Data do pr\xF3ximo vencimento n\xE3o informada."),P++),P>0)return;const ca=parseInt(T),Z=parseFloat(B),aa=new Date(b),ta=new Date(N);return f.value=!0,L.value?j.postAssinatura(ca,V,Z,aa,ta).then(I=>{C({group:"ok",title:"Assinatura criada com sucesso."}),l.init(),m.push(`/assinaturas/${I.data.idAssinatura}`)}).catch(I=>i({apiError:I})).finally(()=>f.value=!1):j.putAssinatura(x.value.idAssinatura,V,Z,aa,ta).then(I=>{C({group:"ok",title:"Assinatura alterada com sucesso."}),l.init()}).catch(I=>i({apiError:I})).finally(()=>f.value=!1)}const M=d(null),F=()=>{M.value=!M.value},o=d(!1);function X(){o.value=!0,l.generateContasAssinaturaProximoVencimento().then(n=>{n.data.length>0?(C({group:"ok",title:"Contas geradas com sucesso."}),l.init()):C({group:"info",title:"Nenhuma assinatura est\xE1 pr\xF3xima do vencimento."})}).catch(n=>C({group:"error",title:n.message||n})).finally(()=>{o.value=!1,M.value&&(M.value=!1)})}return(n,c)=>{const i=va,J=la("RouterLink"),j=ga,T=pa,V=xa,B=ra;return r(),k("div",et,[a("div",st,[a("div",ot,[nt,g(l).assinaturasLoaded?(r(),k(z,{key:1},[v(a("div",ct,[t(J,{to:{name:"assinatura_novo"}},{default:e(()=>[t(i,null,{default:e(()=>[ut]),_:1})]),_:1}),t(i,{onClick:F},{default:e(()=>[v(t(Q,{class:"mr-3"},null,512),[[h,o.value]]),dt]),_:1})],512),[[h,g(O).user.isAdministrador]]),a("div",mt,[(r(!0),k(z,null,oa(g(l).assinaturas,b=>(r(),w(tt,{key:b.idAssinatura,assinatura:b,onRemoverAssinatura:E},null,8,["assinatura"]))),128))]),g(l).assinaturas.length?y("",!0):(r(),k("div",_t," N\xE3o h\xE1 nenhuma assinatura. "))],64)):(r(),k("div",it,[a("div",lt,[t(Q,{height:8,width:8,color:"text-teal-600",class:"mr-3"}),rt])]))])]),t(B,{modalActive:_.value,closeButtonVisible:!1,onCloseModal:G,classPanel:"w-full sm:w-5/6 md:w-4/6 lg:w-3/6"},{default:e(()=>[a("div",ft,[a("div",null,[vt,v(a("div",ht,[x.value.situacao===1?(r(),w(j,{key:0,customColor:"green"},{default:e(()=>[xt]),_:1})):y("",!0),x.value.situacao===0?(r(),w(j,{key:1,customColor:"orange"},{default:e(()=>[pt]),_:1})):y("",!0)],512),[[h,!g(L)]])]),t(g(Ca),{onSubmit:H,"initial-values":x.value,ref:"form"},{default:e(({errors:b})=>[v(t(T,{name:"idCliente",label:"Cliente",disabled:!g(L),class:"mb-2"},{default:e(()=>[(r(!0),k(z,null,oa(Y.value,N=>(r(),k("option",{value:N.idCliente},$(N.nome),9,gt))),256))]),_:1},8,["disabled"]),[[h,Y.value.length>0]]),t(V,{name:"descricao",type:"text",label:"Descri\xE7\xE3o",placeholder:"Descri\xE7\xE3o",class:"mb-2"}),t(V,{name:"valor",type:"number",step:"1",label:"Valor",placeholder:"Valor",class:"mb-2"}),t(V,{name:"dataVencimento",type:"date",label:"Data de vencimento",placeholder:"Data de vencimento",class:"mb-2"}),t(V,{name:"dataProximoVencimento",type:"date",label:"Data do pr\xF3ximo vencimento",placeholder:"Data de vencimento",class:"mb-2"}),a("div",Ct,[t(i,{disabled:f.value,class:"mr-2"},{default:e(()=>[v(a("div",bt,[a("div",At,[t(Q,{class:"mr-2"}),kt])],512),[[h,f.value]]),v(a("div",null," Gravar ",512),[[h,!f.value]])]),_:1},8,["disabled"]),t(J,{to:{name:"assinaturas"},onClick:ha(G,["prevent"]),disable:f.value,class:"mr-2"},{default:e(()=>[t(i,{customColor:"red"},{default:e(()=>[$t]),_:1})]),_:1},8,["onClick","disable"])]),b.apiError?(r(),k("div",yt,$(b.apiError),1)):y("",!0)]),_:1},8,["initial-values"])])]),_:1},8,["modalActive"]),t(B,{modalActive:M.value,closeButtonVisible:!1,onCloseModal:F},{default:e(()=>[Vt,a("div",wt,[t(i,{onClick:X,class:"mr-2"},{default:e(()=>[Dt]),_:1}),t(i,{onClick:F},{default:e(()=>[Mt]),_:1})])]),_:1},8,["modalActive"])])}}};export{Et as default};
